<template>
    <div>
        <h3> Sell options here </h3>
        <form id="optionTypeChoose" class="form_radio">
            <input type="radio" id="choiceCall" v-model="choice" name="optionType" value="choiceCall" checked>
            <label for="choiceCall">Call Option</label>
            
            <input type="radio" id="choicePut" v-model="choice" name="optionType" value="choicePut">
            <label for="choicePut">Put Option</label>
        </form>
    </div>



    <form class="form-input" v-if="this.choice == 'choiceCall'" >
        <div>
            <label for="callTokenAddress" class="label_lg"> Contract address of the Token. Default - CleverWizardToken </label>
            <input type="text" id="callTokenAddress" name="callTokenAddress" v-model.lazy.trim="callTokenAddress" class="input_text" @change="changeCallTokenAddress"/>
        </div>
        <div>
            <label for="callTokenQuantity" class="label_lg"> Token quantity of the call option </label>
            <input type="number" id="callTokenQuantity" name="callTokenQuantity" v-model.lazy.trim="callTokenQuantity" class="input_text" @change="changeCallTokenQuantity"/>
        </div>
        <div>
            <label for="callStrikePrice" class="label_lg"> Strike price in ETH/Token </label>
            <input type="number" id="callStrikePrice" name="callStrikePrice" v-model.lazy.trim="callStrikePrice" class="input_text" @change="changeCallStrikePrice"/>
        </div>
        <div>
            <label for="callPurchasePrice" class="label_lg"> Purchase price in ETH </label>
            <input type="number" id="callPurchasePrice" name="callPurchasePrice" v-model.lazy.trim="callPurchasePrice" class="input_text" @change="changeCallPurchasePrice"/>
        </div>
        <div>
            <label for="callExpiryDate" class="label_lg"> Expiry Date in UTC time format </label>
            <input type="date" id="callExpiryDate" name="callExpiryDate" v-model.lazy.trim="callExpiryDate" class="input_text" @change="changeCallExpiryDate"/>
        </div>
        <div>
            <label for="callExpiryTime" class="label_lg"> Expiry Time in UTC time format </label>
            <input type="time" id="callExpiryTime" name="callExpiryTime" v-model.lazy.trim="callExpiryTime" class="input_text" @change="changeCallExpiryTime"/>
        </div>
        <button type="button" class="sell_form_btn" v-if="!showCallCollateralButton" @click="createCallOption">
                create Call Option
        </button>
        <button type="button" class="sell_form_btn" v-if="showCallCollateralButton" @click="collateralizeCall">
                collateralize Call Option
        </button>

    </form>

    <form class="form-input" v-if="this.choice == 'choicePut'">
        <div>
            <label for="putTokenAddress" class="label_lg"> Contract address of the Token. Default - CleverWizardToken </label>
            <input type="text" id="putTokenAddress" name="putTokenAddress" v-model.lazy.trim="putTokenAddress" class="input_text" @change="changePutTokenAddress"/>
        </div>
        <div>
            <label for="putTokenQuantity" class="label_lg"> Token quantity for the put option </label>
            <input type="number" id="putTokenQuantity" name="putTokenQuantity" v-model.lazy.trim="putTokenQuantity" class="input_text" @change="changePutTokenQuantity"/>
        </div>
        <div>
            <label for="putStrikePrice" class="label_lg"> Strike price in ETH/Token </label>
            <input type="number" id="putStrikePrice" name="putStrikePrice" v-model.lazy.trim="putStrikePrice" class="input_text" @change="changePutStrikePrice"/>
        </div>
        <div>
            <label for="putPurchasePrice" class="label_lg"> Purchase price in ETH </label>
            <input type="number" id="putPurchasePrice" name="putPurchasePrice" v-model.lazy.trim="putPurchasePrice" class="input_text" @change="changePutPurchasePrice"/>
        </div>
        <div>
            <label for="putExpiryDate" class="label_lg"> Expiry Date in UTC time format </label>
            <input type="date" id="putExpiryDate" name="putExpiryDate" v-model.lazy.trim="putExpiryDate" class="input_text" @change="changePutExpiryDate"/>
        </div>
        <div>
            <label for="putExpiryTime" class="label_lg"> Expiry Time in UTC time format </label>
            <input type="time" id="putExpiryTime" name="putExpiryTime" v-model.lazy.trim="putExpiryTime" class="input_text" @change="changePutExpiryTime"/>
        </div>
        <button type="button" class="sell_form_btn" v-if="!showPutCollateralButton" @click="createPutOption">
                Create Put Option
        </button>
        <button type="button" class="sell_form_btn" v-if="showPutCollateralButton" @click="collateralizePut">
                collateralize Put Option
        </button>

    </form>

</template>

<script>
import getWeb3 from "../getWeb3.js";
import CleverWizardToken from "../contracts/CleverWizardToken.json";
import CallOption from "../contracts/CallOption.json";
import PutOption from "../contracts/PutOption.json";
let callOptionAddress = "";
let putOptionAddress = "";
const BN = require('bn.js');



export default {
    data() {
        return {
            choice: "choiceCall",
            callTokenAddress: "",
            callTokenQuantity: 0,
            callStrikePrice: "",
            callPurchasePrice: "",
            callExpiryDate: "",
            callExpiryTime: "",
            putTokenAddress: "",
            putTokenQuantity: 0,
            putStrikePrice: "",
            putPurchasePrice: "",
            putExpiryDate: "",
            putExpiryTime: "",
            showCallCollateralButton: false,
            showPutCollateralButton: false,
        };
    },
    async created() {
        this.$store.commit('initialiseStore');
        this.web3 = await getWeb3();
        this.networkId = await this.web3.eth.getChainId();
        this.cleverWizardToken = await new this.web3.eth.Contract(
            CleverWizardToken.abi,
            CleverWizardToken.networks[this.networkId] && CleverWizardToken.networks[this.networkId].address,
        );
        this.cleverWizardTokenAddress = this.cleverWizardToken.options.address;
        this.$store.commit('setCallTokenAddress', this.cleverWizardTokenAddress);
        this.$store.commit('setPutTokenAddress', this.cleverWizardTokenAddress);
        this.callTokenAddress = this.$store.state.callTokenAddress;
        this.callTokenQuantity = this.$store.state.callTokenQuantity;
        this.callStrikePrice = this.$store.state.callStrikePrice;
        this.callPurchasePrice = this.$store.state.callPurchasePrice;
        this.callExpiryDate = this.$store.state.callExpiryDate;
        this.callExpiryTime = this.$store.state.callExpiryTime;
        this.putTokenAddress = this.$store.state.putTokenAddress;
        this.putTokenQuantity = this.$store.state.putTokenQuantity;
        this.putStrikePrice = this.$store.state.putStrikePrice;
        this.putPurchasePrice = this.$store.state.putPurchasePrice;
        this.putExpiryDate = this.$store.state.putExpiryDate;
        this.putExpiryTime = this.$store.state.putExpiryTime;
    },
    async mounted() {
        this.web3 = await getWeb3();
        this.networkId = await this.web3.eth.getChainId();
        this.accounts = await this.web3.eth.getAccounts();
        this.callOption = await new this.web3.eth.Contract(
            CallOption.abi,
            CallOption.networks[this.networkId] && CallOption.networks[this.networkId].address,
        );
        this.putOption = await new this.web3.eth.Contract(
            PutOption.abi,
            PutOption.networks[this.networkId] && PutOption.networks[this.networkId].address,
        );
    },
    methods: {
        changeCallTokenAddress(){
            this.$store.commit('setCallTokenAddress', this.callTokenAddress);
        },
        changeCallTokenQuantity(){
            this.$store.commit('setCallTokenQuantity', this.callTokenQuantity);
        },
        changeCallStrikePrice(){
            this.$store.commit('setCallStrikePrice', this.callStrikePrice);
        },
        changeCallPurchasePrice(){
            this.$store.commit('setCallPurchasePrice', this.callPurchasePrice);
        },
        changeCallExpiryDate(){
            this.$store.commit('setCallExpiryDate', this.callExpiryDate);
        },
        changeCallExpiryTime(){
            this.$store.commit('setCallExpiryTime', this.callExpiryTime);
        },
        changePutTokenAddress(){
            this.$store.commit('setPutTokenAddress', this.putTokenAddress);
        },
        changePutTokenQuantity(){
            this.$store.commit('setPutTokenQuantity', this.putTokenQuantity);
        },
        changePutStrikePrice(){
            this.$store.commit('setPutStrikePrice', this.putStrikePrice);
        },
        changePutPurchasePrice(){
            this.$store.commit('setPutPurchasePrice', this.putPurchasePrice);
        },
        changePutExpiryDate(){
            this.$store.commit('setPutExpiryDate', this.putExpiryDate);
        },
        changePutExpiryTime(){
            this.$store.commit('setPutExpiryTime', this.putExpiryTime);
        },
        createCallOption(){
            this.$store.commit('setCallTokenQuantity', this.callTokenQuantity);
            this.$store.commit('setCallStrikePrice', this.callStrikePrice);
            this.$store.commit('setCallPurchasePrice', this.callPurchasePrice);
            this.$store.commit('setCallExpiryDate', this.callExpiryDate);
            this.$store.commit('setCallExpiryTime', this.callExpiryTime);
                                    
            let tempTime = Date.parse(this.callExpiryDate + " " + this.callExpiryTime + " UTC");           
            this.callOptionBin = "6101206040523480156200001257600080fd5b50604051620018ca380380620018ca833981810160405281019062000038919062000221565b62000049336200012f60201b60201c565b84608081815250508360a081815250508260c081815250508160e081815250508073ffffffffffffffffffffffffffffffffffffffff166101008173ffffffffffffffffffffffffffffffffffffffff1660601b8152505080600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000600260146101000a81548160ff0219169083151502179055507f63616c6c00000000000000000000000000000000000000000000000000000000600381905550505050505062000320565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b6000815190506200020481620002ec565b92915050565b6000815190506200021b8162000306565b92915050565b600080600080600060a0868803121562000240576200023f620002e7565b5b600062000250888289016200020a565b955050602062000263888289016200020a565b945050604062000276888289016200020a565b935050606062000289888289016200020a565b92505060806200029c88828901620001f3565b9150509295509295909350565b6000620002b682620002bd565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600080fd5b620002f781620002a9565b81146200030357600080fd5b50565b6200031181620002dd565b81146200031d57600080fd5b50565b60805160a05160c05160e0516101005160601c611523620003a76000396000610abc0152600081816102070152818161046a0152610a870152600081816108150152610a660152600081816104ed0152610a450152600081816102b0015281816104cc015281816105ba015281816107090152818161094d0152610a2401526115236000f3fe60806040526004361061007f5760003560e01c80636dd62d261161004e5780636dd62d26146100de578063715018a6146101105780638da5cb5b14610127578063f2fde38b1461015257610086565b8063590e1ae314610088578063603daf9a1461009f57806361461954146100ca57806364edfbf0146100d457610086565b3661008657005b005b34801561009457600080fd5b5061009d61017b565b005b3480156100ab57600080fd5b506100b461035f565b6040516100c19190610fb4565b60405180910390f35b6100d2610389565b005b6100dc6106b7565b005b3480156100ea57600080fd5b506100f361093f565b604051610107989796959493929190611153565b60405180910390f35b34801561011c57600080fd5b50610125610af5565b005b34801561013357600080fd5b5061013c610b76565b6040516101499190610fb4565b60405180910390f35b34801561015e57600080fd5b5061017960048036038101906101749190610d93565b610b9f565b005b3373ffffffffffffffffffffffffffffffffffffffff1661019a610b76565b73ffffffffffffffffffffffffffffffffffffffff16146101f0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101e790611078565b60405180910390fd5b600260149054906101000a900460ff1615610268577f00000000000000000000000000000000000000000000000000000000000000004211610267576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161025e90611118565b60405180910390fd5b5b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663a9059cbb6102ae610b76565b7f00000000000000000000000000000000000000000000000000000000000000006040518363ffffffff1660e01b81526004016102ec929190610fcf565b602060405180830381600087803b15801561030657600080fd5b505af115801561031a573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061033e9190610dc0565b50610347610b76565b73ffffffffffffffffffffffffffffffffffffffff16ff5b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b600260149054906101000a900460ff166103d8576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103cf90611098565b60405180910390fd5b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610468576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161045f90611058565b60405180910390fd5b7f000000000000000000000000000000000000000000000000000000000000000042106104ca576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104c1906110f8565b60405180910390fd5b7f00000000000000000000000000000000000000000000000000000000000000007f000000000000000000000000000000000000000000000000000000000000000061051691906111e2565b3414610557576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161054e90611038565b60405180910390fd5b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663a9059cbb600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff167f00000000000000000000000000000000000000000000000000000000000000006040518363ffffffff1660e01b81526004016105f6929190610fcf565b602060405180830381600087803b15801561061057600080fd5b505af1158015610624573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906106489190610dc0565b503373ffffffffffffffffffffffffffffffffffffffff167faea8f355600f3be5583ea20692a33eaf6b7314208d1670b0a0b81773cf902db44260405161068f9190611138565b60405180910390a261069f610b76565b73ffffffffffffffffffffffffffffffffffffffff16ff5b600260149054906101000a900460ff1615610707576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106fe906110d8565b60405180910390fd5b7f0000000000000000000000000000000000000000000000000000000000000000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b81526004016107839190610fb4565b60206040518083038186803b15801561079b57600080fd5b505afa1580156107af573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906107d39190610ded565b14610813576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161080a90611018565b60405180910390fd5b7f00000000000000000000000000000000000000000000000000000000000000003414610875576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161086c90610ff8565b60405180910390fd5b33600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001600260146101000a81548160ff0219169083151502179055503373ffffffffffffffffffffffffffffffffffffffff166108f0610b76565b73ffffffffffffffffffffffffffffffffffffffff167f5e3aefaecafb6a4e6bb53524f68c3454889ad21a6398311995486cef5780e4e3426040516109359190611138565b60405180910390a3565b6000806000806000806000807f0000000000000000000000000000000000000000000000000000000000000000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b81526004016109c79190610fb4565b60206040518083038186803b1580156109df57600080fd5b505afa1580156109f3573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610a179190610ded565b1415610a2257600193505b7f00000000000000000000000000000000000000000000000000000000000000007f00000000000000000000000000000000000000000000000000000000000000007f00000000000000000000000000000000000000000000000000000000000000007f000000000000000000000000000000000000000000000000000000000000000087600260149054906101000a900460ff166003547f0000000000000000000000000000000000000000000000000000000000000000975097509750975097509750975097509091929394959697565b3373ffffffffffffffffffffffffffffffffffffffff16610b14610b76565b73ffffffffffffffffffffffffffffffffffffffff1614610b6a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b6190611078565b60405180910390fd5b610b746000610c90565b565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b3373ffffffffffffffffffffffffffffffffffffffff16610bbe610b76565b73ffffffffffffffffffffffffffffffffffffffff1614610c14576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c0b90611078565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161415610c84576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c7b906110b8565b60405180910390fd5b610c8d81610c90565b50565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b600081359050610d63816114a8565b92915050565b600081519050610d78816114bf565b92915050565b600081519050610d8d816114d6565b92915050565b600060208284031215610da957610da86112bd565b5b6000610db784828501610d54565b91505092915050565b600060208284031215610dd657610dd56112bd565b5b6000610de484828501610d69565b91505092915050565b600060208284031215610e0357610e026112bd565b5b6000610e1184828501610d7e565b91505092915050565b610e238161123c565b82525050565b610e328161124e565b82525050565b610e418161125a565b82525050565b6000610e546018836111d1565b9150610e5f826112c2565b602082019050919050565b6000610e776020836111d1565b9150610e82826112eb565b602082019050919050565b6000610e9a600d836111d1565b9150610ea582611314565b602082019050919050565b6000610ebd602c836111d1565b9150610ec88261133d565b604082019050919050565b6000610ee06015836111d1565b9150610eeb8261138c565b602082019050919050565b6000610f036015836111d1565b9150610f0e826113b5565b602082019050919050565b6000610f26601d836111d1565b9150610f31826113de565b602082019050919050565b6000610f49601b836111d1565b9150610f5482611407565b602082019050919050565b6000610f6c6011836111d1565b9150610f7782611430565b602082019050919050565b6000610f8f6023836111d1565b9150610f9a82611459565b604082019050919050565b610fae81611284565b82525050565b6000602082019050610fc96000830184610e1a565b92915050565b6000604082019050610fe46000830185610e1a565b610ff16020830184610fa5565b9392505050565b6000602082019050818103600083015261101181610e47565b9050919050565b6000602082019050818103600083015261103181610e6a565b9050919050565b6000602082019050818103600083015261105181610e8d565b9050919050565b6000602082019050818103600083015261107181610eb0565b9050919050565b6000602082019050818103600083015261109181610ed3565b9050919050565b600060208201905081810360008301526110b181610ef6565b9050919050565b600060208201905081810360008301526110d181610f19565b9050919050565b600060208201905081810360008301526110f181610f3c565b9050919050565b6000602082019050818103600083015261111181610f5f565b9050919050565b6000602082019050818103600083015261113181610f82565b9050919050565b600060208201905061114d6000830184610fa5565b92915050565b600061010082019050611169600083018b610fa5565b611176602083018a610fa5565b6111836040830189610fa5565b6111906060830188610fa5565b61119d6080830187610e29565b6111aa60a0830186610e29565b6111b760c0830185610e38565b6111c460e0830184610e1a565b9998505050505050505050565b600082825260208201905092915050565b60006111ed82611284565b91506111f883611284565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff04831182151516156112315761123061128e565b5b828202905092915050565b600061124782611264565b9050919050565b60008115159050919050565b6000819050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600080fd5b7f496e636f72726563742070757263686173652070726963650000000000000000600082015250565b7f4f7074696f6e206973206e6f7420636f6c6c61746572616c697a656420796574600082015250565b7f5061796d656e74206572726f7200000000000000000000000000000000000000600082015250565b7f596f752061726520756e617574686f72697a656420666f7220746865206f707460008201527f696f6e20636f6e74726163740000000000000000000000000000000000000000602082015250565b7f596f7520617265206e6f7420746865204f776e65720000000000000000000000600082015250565b7f4f7074696f6e20697320756e7075726368617365640000000000000000000000600082015250565b7f4e6577206f776e657220697320746865207a65726f2061646472657373000000600082015250565b7f4f7074696f6e20697320616c7265616479207075726368617365640000000000600082015250565b7f4f7074696f6e2069732045787069726564000000000000000000000000000000600082015250565b7f4f7074696f6e20636f6e747261637420686173206e6f7420657870697265642060008201527f7965740000000000000000000000000000000000000000000000000000000000602082015250565b6114b18161123c565b81146114bc57600080fd5b50565b6114c88161124e565b81146114d357600080fd5b50565b6114df81611284565b81146114ea57600080fd5b5056fea264697066735822122020d8d882918b56e20410ea19b290211e11167cb2e90f2ed027d05398560c83bd64736f6c63430008060033"
                       
            this.callOption.deploy({
                data: this.callOptionBin,
                arguments: [this.callTokenQuantity, this.web3.utils.toWei(this.callStrikePrice, 'ether'), this.web3.utils.toWei(this.callPurchasePrice, 'ether'), tempTime, this.callTokenAddress]
            }).send({
                    from: this.accounts[0],
                    gas: 3000000,
                    gasPrice: '30000000000'
                }).then(async function(newContractInstance){
                        await alert("Your call option contract address is: " + newContractInstance.options.address + "\n Please write it down");
                        callOptionAddress = await newContractInstance.options.address;
                    });
            this.showCallCollateralButton = true;     
        },
        createPutOption(){
            this.$store.commit('setPutTokenQuantity', this.putTokenQuantity);
            this.$store.commit('setPutStrikePrice', this.putStrikePrice);
            this.$store.commit('setPutPurchasePrice', this.putPurchasePrice);
            this.$store.commit('setPutExpiryDate', this.putExpiryDate);
            this.$store.commit('setPutExpiryTime', this.putExpiryTime);
                                    
            let tempTime = Date.parse(this.putExpiryDate + " " + this.putExpiryTime + " UTC");           
            this.putOptionBin = "6101206040523480156200001257600080fd5b50604051620019bc380380620019bc83398181016040528101906200003891906200023c565b62000049336200014a60201b60201c565b84608081815250508360a081815250508260c081815250508160e081815250508073ffffffffffffffffffffffffffffffffffffffff166101008173ffffffffffffffffffffffffffffffffffffffff1660601b8152505080600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000600260146101000a81548160ff0219169083151502179055506000600260156101000a81548160ff0219169083151502179055507f707574000000000000000000000000000000000000000000000000000000000060038190555050505050506200033b565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b6000815190506200021f8162000307565b92915050565b600081519050620002368162000321565b92915050565b600080600080600060a086880312156200025b576200025a62000302565b5b60006200026b8882890162000225565b95505060206200027e8882890162000225565b9450506040620002918882890162000225565b9350506060620002a48882890162000225565b9250506080620002b7888289016200020e565b9150509295509295909350565b6000620002d182620002d8565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600080fd5b6200031281620002c4565b81146200031e57600080fd5b50565b6200032c81620002f8565b81146200033857600080fd5b50565b60805160a05160c05160e0516101005160601c6115fa620003c260003960006109bc015260008181610229015281816103d001526109780152600081816107dd0152610957015260008181610651015281816109360152610b160152600081816104320152818161058401528181610672015281816109150152610b3701526115fa6000f3fe60806040526004361061008a5760003560e01c80636dd62d26116100595780636dd62d26146100f6578063715018a6146101285780638da5cb5b1461013f578063eef9a8d51461016a578063f2fde38b1461017457610091565b8063590e1ae314610093578063603daf9a146100aa57806361461954146100d557806364edfbf0146100ec57610091565b3661009157005b005b34801561009f57600080fd5b506100a861019d565b005b3480156100b657600080fd5b506100bf6102c5565b6040516100cc9190610ff6565b60405180910390f35b3480156100e157600080fd5b506100ea6102ef565b005b6100f4610735565b005b34801561010257600080fd5b5061010b610907565b60405161011f9897969594939291906111b5565b60405180910390f35b34801561013457600080fd5b5061013d6109f5565b005b34801561014b57600080fd5b50610154610a76565b6040516101619190610ff6565b60405180910390f35b610172610a9f565b005b34801561018057600080fd5b5061019b60048036038101906101969190610db2565b610bbe565b005b3373ffffffffffffffffffffffffffffffffffffffff166101bc610a76565b73ffffffffffffffffffffffffffffffffffffffff1614610212576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610209906110ba565b60405180910390fd5b600260149054906101000a900460ff161561028a577f00000000000000000000000000000000000000000000000000000000000000004211610289576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102809061117a565b60405180910390fd5b5b6000600260156101000a81548160ff0219169083151502179055506102ad610a76565b73ffffffffffffffffffffffffffffffffffffffff16ff5b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b600260149054906101000a900460ff1661033e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610335906110da565b60405180910390fd5b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146103ce576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103c59061109a565b60405180910390fd5b7f00000000000000000000000000000000000000000000000000000000000000004210610430576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104279061113a565b60405180910390fd5b7f0000000000000000000000000000000000000000000000000000000000000000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b81526004016104ac9190610ff6565b60206040518083038186803b1580156104c457600080fd5b505afa1580156104d8573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906104fc9190610e0c565b1461053c576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105339061107a565b60405180910390fd5b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663a9059cbb610582610a76565b7f00000000000000000000000000000000000000000000000000000000000000006040518363ffffffff1660e01b81526004016105c0929190611011565b602060405180830381600087803b1580156105da57600080fd5b505af11580156105ee573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906106129190610ddf565b50600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc7f00000000000000000000000000000000000000000000000000000000000000007f000000000000000000000000000000000000000000000000000000000000000061069b9190611244565b9081150290604051600060405180830381858888f193505050501580156106c6573d6000803e3d6000fd5b503373ffffffffffffffffffffffffffffffffffffffff167faea8f355600f3be5583ea20692a33eaf6b7314208d1670b0a0b81773cf902db44260405161070d919061119a565b60405180910390a261071d610a76565b73ffffffffffffffffffffffffffffffffffffffff16ff5b600260149054906101000a900460ff1615610785576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161077c9061111a565b60405180910390fd5b60011515600260159054906101000a900460ff161515146107db576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107d29061105a565b60405180910390fd5b7f0000000000000000000000000000000000000000000000000000000000000000341461083d576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108349061103a565b60405180910390fd5b33600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001600260146101000a81548160ff0219169083151502179055503373ffffffffffffffffffffffffffffffffffffffff166108b8610a76565b73ffffffffffffffffffffffffffffffffffffffff167f5e3aefaecafb6a4e6bb53524f68c3454889ad21a6398311995486cef5780e4e3426040516108fd919061119a565b60405180910390a3565b6000806000806000806000807f00000000000000000000000000000000000000000000000000000000000000007f00000000000000000000000000000000000000000000000000000000000000007f00000000000000000000000000000000000000000000000000000000000000007f0000000000000000000000000000000000000000000000000000000000000000600260159054906101000a900460ff16600260149054906101000a900460ff166003547f0000000000000000000000000000000000000000000000000000000000000000975097509750975097509750975097509091929394959697565b3373ffffffffffffffffffffffffffffffffffffffff16610a14610a76565b73ffffffffffffffffffffffffffffffffffffffff1614610a6a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a61906110ba565b60405180910390fd5b610a746000610caf565b565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b3373ffffffffffffffffffffffffffffffffffffffff16610abe610a76565b73ffffffffffffffffffffffffffffffffffffffff1614610b14576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b0b906110ba565b60405180910390fd5b7f00000000000000000000000000000000000000000000000000000000000000007f0000000000000000000000000000000000000000000000000000000000000000610b609190611244565b3414610ba1576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b989061115a565b60405180910390fd5b6001600260156101000a81548160ff021916908315150217905550565b3373ffffffffffffffffffffffffffffffffffffffff16610bdd610a76565b73ffffffffffffffffffffffffffffffffffffffff1614610c33576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c2a906110ba565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161415610ca3576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c9a906110fa565b60405180910390fd5b610cac81610caf565b50565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b600081359050610d828161157f565b92915050565b600081519050610d9781611596565b92915050565b600081519050610dac816115ad565b92915050565b600060208284031215610dc857610dc761131f565b5b6000610dd684828501610d73565b91505092915050565b600060208284031215610df557610df461131f565b5b6000610e0384828501610d88565b91505092915050565b600060208284031215610e2257610e2161131f565b5b6000610e3084828501610d9d565b91505092915050565b610e428161129e565b82525050565b610e51816112b0565b82525050565b610e60816112bc565b82525050565b6000610e73601883611233565b9150610e7e82611324565b602082019050919050565b6000610e96602083611233565b9150610ea18261134d565b602082019050919050565b6000610eb9602483611233565b9150610ec482611376565b604082019050919050565b6000610edc602c83611233565b9150610ee7826113c5565b604082019050919050565b6000610eff601583611233565b9150610f0a82611414565b602082019050919050565b6000610f22601583611233565b9150610f2d8261143d565b602082019050919050565b6000610f45601d83611233565b9150610f5082611466565b602082019050919050565b6000610f68601b83611233565b9150610f738261148f565b602082019050919050565b6000610f8b601183611233565b9150610f96826114b8565b602082019050919050565b6000610fae602e83611233565b9150610fb9826114e1565b604082019050919050565b6000610fd1602383611233565b9150610fdc82611530565b604082019050919050565b610ff0816112e6565b82525050565b600060208201905061100b6000830184610e39565b92915050565b60006040820190506110266000830185610e39565b6110336020830184610fe7565b9392505050565b6000602082019050818103600083015261105381610e66565b9050919050565b6000602082019050818103600083015261107381610e89565b9050919050565b6000602082019050818103600083015261109381610eac565b9050919050565b600060208201905081810360008301526110b381610ecf565b9050919050565b600060208201905081810360008301526110d381610ef2565b9050919050565b600060208201905081810360008301526110f381610f15565b9050919050565b6000602082019050818103600083015261111381610f38565b9050919050565b6000602082019050818103600083015261113381610f5b565b9050919050565b6000602082019050818103600083015261115381610f7e565b9050919050565b6000602082019050818103600083015261117381610fa1565b9050919050565b6000602082019050818103600083015261119381610fc4565b9050919050565b60006020820190506111af6000830184610fe7565b92915050565b6000610100820190506111cb600083018b610fe7565b6111d8602083018a610fe7565b6111e56040830189610fe7565b6111f26060830188610fe7565b6111ff6080830187610e48565b61120c60a0830186610e48565b61121960c0830185610e57565b61122660e0830184610e39565b9998505050505050505050565b600082825260208201905092915050565b600061124f826112e6565b915061125a836112e6565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0483118215151615611293576112926112f0565b5b828202905092915050565b60006112a9826112c6565b9050919050565b60008115159050919050565b6000819050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600080fd5b7f496e636f72726563742070757263686173652070726963650000000000000000600082015250565b7f4f7074696f6e206973206e6f7420636f6c6c61746572616c697a656420796574600082015250565b7f546f6b656e732068617665206e6f74206265656e207472616e7366657272656460008201527f2079657400000000000000000000000000000000000000000000000000000000602082015250565b7f596f752061726520756e617574686f72697a656420666f7220746865206f707460008201527f696f6e20636f6e74726163740000000000000000000000000000000000000000602082015250565b7f596f7520617265206e6f7420746865204f776e65720000000000000000000000600082015250565b7f4f7074696f6e20697320756e7075726368617365640000000000000000000000600082015250565b7f4e6577206f776e657220697320746865207a65726f2061646472657373000000600082015250565b7f4f7074696f6e20697320616c7265616479207075726368617365640000000000600082015250565b7f4f7074696f6e2069732045787069726564000000000000000000000000000000600082015250565b7f4e6f742074686520726967687420616d6f756e74206f6620636f6c6c6174657260008201527f616c207472616e73666572726564000000000000000000000000000000000000602082015250565b7f4f7074696f6e20636f6e747261637420686173206e6f7420657870697265642060008201527f7965740000000000000000000000000000000000000000000000000000000000602082015250565b6115888161129e565b811461159357600080fd5b50565b61159f816112b0565b81146115aa57600080fd5b50565b6115b6816112e6565b81146115c157600080fd5b5056fea264697066735822122087f7db4b1a9a6ba8d66df1c314563c84ac672a707c866f474bda298b4b3110af64736f6c63430008060033"
            
            this.putOption.deploy({
                data: this.putOptionBin,
                arguments: [this.putTokenQuantity, this.web3.utils.toWei(this.putStrikePrice, 'ether'), this.web3.utils.toWei(this.putPurchasePrice, 'ether'), tempTime, this.putTokenAddress]
            }).send({
                    from: this.accounts[0],
                    gas: 3000000,
                    gasPrice: '30000000000'
                }).then(async function(newContractInstance){
                        await alert("Your put option contract address is: " + newContractInstance.options.address + "\n Please write it down");
                        putOptionAddress = await newContractInstance.options.address;                        
                    }); 
            this.showPutCollateralButton = true;    
        },
        collateralizeCall() {
            let transactionHash = "";
            let functionData = this.web3.eth.abi.encodeFunctionCall({
                name: 'transfer',
                type: 'function',
                inputs: [{type: 'address', name: 'recipient'},{type:'uint256', name:'amount'}]
                }, [callOptionAddress, this.callTokenQuantity]);            

            this.web3.eth.sendTransaction({
                from: this.accounts[0],
                to: this.callTokenAddress,
                data: functionData
            })
            .on('transactionHash', function(hash){
                transactionHash = hash;
                alert("Your transaction Hash is " + transactionHash);                
            })
            .on('confirmation', function(confirmationNumber, receipt){ console.log(receipt); })
        },
        collateralizePut() {
            let transactionHash = "";
            let functionData = this.web3.eth.abi.encodeFunctionSignature('collateralize()')
            let ethValue = (new BN(this.putTokenQuantity).mul(new BN(this.putStrikePrice))).toString();
            ethValue = this.web3.utils.toWei(ethValue, 'ether');
            
            this.web3.eth.sendTransaction({
                from: this.accounts[0],
                to: putOptionAddress,
                data: functionData,
                value: ethValue
            })
            .on('transactionHash', function(hash){
                transactionHash = hash;
                alert("Your transaction Hash is " + transactionHash);                
            })
            .on('confirmation', function(confirmationNumber, receipt){ console.log(receipt); })

        }

    },
    components: {

    }
}
</script>

<style>

    .sell_form_btn {
        border: 0.2rem solid  #132237;
        cursor: pointer;
        text-transform: capitalize;
        width: 30%;
        height: 2rem;
        background-color: #D8D8D8;
        border-radius: 1rem;
        color:  #132237;
        font-size: 1rem;
        margin-top: 1.5rem;
    }

    .sell_form_btn:Hover, .sell_form_btn:Focus {
        box-shadow: 0 0 7px #3C9BED;
        border: 0.1rem solid #3C9BED;
        background-color: #ecd484;
        color: #1f376a;
    }

    @media (max-width: 600px) {
        .sell_form_btn {
            width: 60%;
        }
    }

</style>
